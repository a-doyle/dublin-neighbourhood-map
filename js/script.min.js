var map;var clientID;var clientSecret;var markers=[];var polygon=null;var placeMarkers=[];function initMap(){var styles=[{"featureType":"all","elementType":"all","stylers":[{"invert_lightness":!0},{"saturation":"-9"},{"lightness":"0"},{"visibility":"simplified"}]},{"featureType":"landscape.man_made","elementType":"all","stylers":[{"weight":"1.00"}]},{"featureType":"road.highway","elementType":"all","stylers":[{"weight":"0.49"}]},{"featureType":"road.highway","elementType":"labels","stylers":[{"visibility":"on"},{"weight":"0.01"},{"lightness":"-7"},{"saturation":"-35"}]},{"featureType":"road.highway","elementType":"labels.text","stylers":[{"visibility":"on"}]},{"featureType":"road.highway","elementType":"labels.text.stroke","stylers":[{"visibility":"off"}]},{"featureType":"road.highway","elementType":"labels.icon","stylers":[{"visibility":"on"}]}]
map=new google.maps.Map(document.getElementById('map'),{center:{lat:53.256488,lng:-6.173485},zoom:13,styles:styles,mapTypeControl:!1});var timeAutocomplete=new google.maps.places.Autocomplete(document.getElementById('search-within-time-text'));var zoomAutocomplete=new google.maps.places.Autocomplete(document.getElementById('zoom-to-area-text'));zoomAutocomplete.bindTo('bounds',map);var searchBox=new google.maps.places.SearchBox(document.getElementById('places-search'));searchBox.setBounds(map.getBounds());var locations=[{title:'Casa Pieterson',location:{lat:53.248474,lng:-6.118022}},{title:'Casa Montgomurdy',location:{lat:53.262201,lng:-6.137107}},{title:'Casa Doyle',location:{lat:53.256488,lng:-6.173485}},{title:'Casa OJ',location:{lat:53.249389,lng:-6.120903}},{title:'Casa McSwizzle',location:{lat:53.284825,lng:-6.136605}},{title:'Casa DePhatoul',location:{lat:53.2885855,lng:-6.1442889}},{title:'Casa Raymundo',location:{lat:53.268746,lng:-6.1468032}},{title:'Casa Coin',location:{lat:53.2315043,lng:-6.1200784}},{title:'Casa Bob',location:{lat:53.2707626,lng:-6.1428819}}];var largeInfoWindow=new google.maps.InfoWindow();var drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}});var defaultIcon=makeMarkerIcon('0091ff');var highlightedIcon=makeMarkerIcon('FFFF24');for(var i=0;i<locations.length;i++){var position=locations[i].location;var title=locations[i].title;var marker=new google.maps.Marker({position:position,title:title,icon:defaultIcon,animation:google.maps.Animation.DROP,id:i});markers.push(marker);marker.addListener('click',function(){populateInfoWindow(this,largeInfoWindow)});marker.addListener('mouseover',function(){this.setIcon(highlightedIcon)});marker.addListener('mouseout',function(){this.setIcon(defaultIcon)})}
document.getElementById('show-listings').addEventListener('click',showListings);document.getElementById('hide-listings').addEventListener('click',function(){hideMarkers(markers)});document.getElementById('toggle-drawing').addEventListener('click',function(){toggleDrawing(drawingManager)});document.getElementById('zoom-to-area').addEventListener('click',function(){zoomToArea()});document.getElementById('search-within-time').addEventListener('click',function(){searchWithinTime()});searchBox.addListener('places_changed',function(){searchBoxPlaces(this)});document.getElementById('go-places').addEventListener('click',textSearchPlaces);drawingManager.addListener('overlaycomplete',function(event){if(polygon){polygon.setMap(null);hideListings}
drawingManager.setDrawingMode(null);polygon=event.overlay;polygon.setEditable(!0);searchWithinPolygon();polygon.getPath().addListener('set_at',searchWithinPolygon);polygon.getPath().addListener('insert_at',searchWithinPolygon)})}
function createMarkersForPlaces(places){var bounds=new google.maps.LatLngBounds();for(var i=0;i<places.length;i++){var place=places[i];var icon={url:place.icon,size:new google.maps.Size(35,35),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,34),scaledSize:new google.maps.Size(25,25)};var marker=new google.maps.Marker({map:map,icon:icon,title:place.name,position:place.geometry.location,id:place.place_id});var placeInfoWindow=new google.maps.InfoWindow();marker.addListener('click',function(){if(placeInfoWindow.marker==this){console.log("This infowindow is already on this marker")}else{getPlacesDetails(this,placeInfoWindow)}});placeMarkers.push(marker);if(place.geometry.viewport){bounds.union(place.geometry.viewport)}else{bounds.extend(place.geometry.location)}}
map.fitBounds(bounds)}
function getPlacesDetails(marker,infoWindow){var service=new google.maps.places.PlacesService(map);service.getDetails({placeId:marker.id},function(place,status){if(status===google.maps.places.PlacesServiceStatus.OK){infoWindow.marker=marker;var innerHTML='<div>';if(place.name){innerHTML+='<strong>'+place.name+'</strong>'}
if(place.formatted_address){innerHTML+='<br>'+place.formatted_address}
if(place.formatted_phone_number){innerHTML+='<br>'+place.formatted_phone_number}
if(place.opening_hours){innerHTML+='<br><br><strong>Hours:</strong><br>'+place.opening_hours.weekday_text[0]+'<br>'+place.opening_hours.weekday_text[1]+'<br>'+place.opening_hours.weekday_text[2]+'<br>'+place.opening_hours.weekday_text[3]+'<br>'+place.opening_hours.weekday_text[4]+'<br>'+place.opening_hours.weekday_text[5]+'<br>'+place.opening_hours.weekday_text[6]}
if(place.photos){innerHTML+='<br><br><img src="'+place.photos[0].getUrl({maxHeight:100,maxWidth:200})+'">'}
innerHTML+='</div>';infoWindow.setContent(innerHTML);infoWindow.open(map,marker);infoWindow.addListener('closeclick',function(){infoWindow.marker=null})}})}
function makeMarkerIcon(markerColor){var markerImage=new google.maps.MarkerImage('http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|'+markerColor+'|40|_|%E2%80%A2',new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34));return markerImage}
function toggleDrawing(drawingManager){if(drawingManager.map){drawingManager.setMap(null);if(polygon){polygon.setMap(null)}}else{drawingManager.setMap(map)}}
function populateInfoWindow(marker,infoWindow){if(infoWindow.marker!=marker){infoWindow.setContent('');infoWindow.marker=marker;infoWindow.addListener('closeclick',function(){infoWindow.marker=null});var streetViewService=new google.maps.StreetViewService();var radius=50;function getStreetView(data,status){if(status==google.maps.StreetViewStatus.OK){var nearStreetViewLocation=data.location.latLng;var heading=google.maps.geometry.spherical.computeHeading(nearStreetViewLocation,marker.position);infoWindow.setContent('<div>'+marker.title+'</div><div id="pano"></div>');var panoramaOptions={position:nearStreetViewLocation,pov:{heading:heading,pitch:20}};var panorama=new google.maps.StreetViewPanorama(document.getElementById('pano'),panoramaOptions)}else{infoWindow.setContent('<div>'+marker.title+'</div>'+'<div>No Street View Found</div>')}}
streetViewService.getPanoramaByLocation(marker.position,radius,getStreetView);infoWindow.open(map,marker)}}
function showListings(){var bounds=new google.maps.LatLngBounds();for(var i=0;i<markers.length;i++){markers[i].setMap(map);bounds.extend(markers[i].position)}
map.fitBounds(bounds)}
function hideMarkers(markers){for(var i=0;i<markers.length;i++){markers[i].setMap(null)}}
function displayMarkersWithinTime(response){var maxDuration=document.getElementById('max-duration').value;var origins=response.originAddresses;var destinations=response.destinationAddresses;var atLeastOne=!1;for(var i=0;i<origins.length;i++){var results=response.rows[i].elements;for(var j=0;j<results.length;j++){var element=results[j];if(element.status==="OK"){var distanceText=element.distance.text;var duration=element.duration.value/60;var durationText=element.duration.text;if(duration<=maxDuration){markers[i].setMap(map);atLeastOne=!0;var infoWindow=new google.maps.InfoWindow({content:durationText+' away, '+distanceText+'<div><input type=\"button\" value=\"View Route\" onclick='+'\"displayDirections(&quot;'+origins[i]+'&quot;);\"</input></div'});infoWindow.open(map,markers[i]);markers[i].infoWindow=infoWindow;google.maps.event.addListener(markers[i],'click',function(){this.infoWindow.close()})}}}}
if(!atLeastOne){window.alert('We could not find any locations within that distance!')}}
function zoomToArea(){var geocoder=new google.maps.Geocoder();var address=document.getElementById('zoom-to-area-text').value;if(address==''){window.alert('You must enter an valid area or address.')}else{geocoder.geocode({address:address,componentRestrictions:{locality:'Dublin'}},function(results,status){if(status==google.maps.GeocoderStatus.OK){map.setCenter(results[0].geometry.location);map.setZoom(15)}else{window.alert('We could not find that location - try entering a more specific place.')}})}}
function searchWithinPolygon(){for(var i=0;i<markers.length;i++){if(google.maps.geometry.poly.containsLocation(markers[i].position,polygon)){markers[i].setMap(map)}else{markers[i].setMap(null)}}}
function searchWithinTime(){var distanceMatrixService=new google.maps.DistanceMatrixService;var address=document.getElementById('search-within-time-text').value;if(address==''){window.alert('You must enter an address.')}else{hideMarkers(markers);var origins=[];for(var i=0;i<markers.length;i++){origins[i]=markers[i].position}
var destination=address;var mode=document.getElementById('mode').value;distanceMatrixService.getDistanceMatrix({origins:origins,destinations:[destination],travelMode:google.maps.TravelMode[mode],unitSystem:google.maps.UnitSystem.IMPERIAL,},function(response,status){if(status!==google.maps.DistanceMatrixStatus.OK){window.alert('Error was: '+status)}else{displayMarkersWithinTime(response)}})}}
function displayDirections(origin){hideMarkers(markers);var directionsService=new google.maps.DirectionsService;var destinationAddress=document.getElementById('search-within-time-text').value;var mode=document.getElementById('mode').value;directionsService.route({origin:origin,destination:destinationAddress,travelMode:google.maps.TravelMode[mode]},function(response,status){if(status===google.maps.DirectionsStatus.OK){var directionsDisplay=new google.maps.DirectionsRenderer({map:map,directions:response,draggable:!0,polylineOptions:{strokeColor:'aquamarine'}})}else{window.alert('Directions request failed due to '+status)}})}
function searchBoxPlaces(searchBox){hideMarkers(placeMarkers);var places=searchBox.getPlaces();createMarkersForPlaces(places);if(places.length==0){window.alert('We did not find any places matching that search!')}}
function textSearchPlaces(){var bounds=map.getBounds();hideMarkers(placeMarkers);var placesService=new google.maps.places.PlacesService(map);placesService.textSearch({query:document.getElementById('places-search').value,bounds:bounds},function(results,status){if(status==google.maps.places.PlacesServiceStatus.OK){createMarkersForPlaces(results)}})}
function errorHandling(){window.alert('Google Maps has failed to load. Please try again.')}